<%- include('partials/header') %>
    <div class="home ">
        <div class="create animate__animated animate__rubberBand animate__infinite " data-toggle="modal"
            data-target="#exampleModalCenter">
            <a href="#"> <img
                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAtElEQVRoQ+2W0Q2AIAxEYRRXYP8ZWMFRNP4YgyEcNI2pef7SVvruSppT8C8Hv3+iga8VRAEUMBLAQkaA5nQU6CHcSzmeZ1utLrBcil4XpwFxOlCAGRCt0gvDQlgICxkJYCEjQPkValcD43+H6eruRANDlIsBKLAI7k5jnRYJykMs1kOBWVAowCox65kmHgthISxkJPBbCzlxeZV1e4VoQCSAAiIotzAUcEMrFkYBEZRbWHgFTog6cDG63F0TAAAAAElFTkSuQmCC" />
            </a>
        </div>
        <div class="history animate__animated animate__rotateIn animate__infinite">
            <a href="/history"> <img
                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAC+klEQVRYR+2X3VnbMBSGPykDlE5QNAGO4L7JBukELRPQDRo2CBMAE5RO0OSeKGYCwwbJAEh9jiXbsmPLctKLXKBbS8evznf+xHBii50YDz6A+hQ52kNZkpwDuADnSfkzrVMALyJNX/sAmt8PAsohOL8BMANAQF2LgJ6g9V0s3CCgLEnOHMh86M0BzB3YNnQ2GihLkgSj0T2MqaSxlncASKKl96MJANr3qfZzxlK8v1+LNKX9rSsKKIfh/C+AM8/KCowtxHr91GU8u7ycwZifAL56e7bQetoF1QvkZMo8GPLIXCi1iJUtk5KgSObCYwQlRJruydcPJCVJUdxwB60nIZd3est6mWxZKGOWYrOZDsoy5/Lf5SHOp+L52Y+VWCfl+7Krqwm0JuntYuxbU/KghzIpKW2/uON3QilyfevKpDTFB6FUp91MSpKaSgatV6GU8A12H7Qu3rjNJNV5m+aFsWggWzroolY6rcd+CIRuQkH4y+n9KDabHyF9YoFy6cbjBzD23dm7FUqVdS0EVAVzi9ZNuEFAthwUsbkSSlHdsmEViAlKycKtlKLBvuQDuRSvTHO+8pPBtR4qJbS2QqnPMUBRQdoWQy2XrMmSy9aRBDUPNbTdt2tMZyw1PNQ8eyCQzQCKnYuWW764otjaHDMpuxsu58uAZDuhVNmS9mLI9a2qolqygyt0W4w2Cm5/UGdSUorfe8auhVIPobQf8u2wtC9qRSBuhkCUwW/DomrW0YWRDjK2oPEhVKGHQjVax5tQqjZx9nb7oT8M7T+6ue5VY+pvAI4YP/whrxbMvYWxFcZOjTQ2zMV6fRfrPTegUV8s0ruzWUdL1hhF8gELxixEmv7pbD/Us7S+AWNlr+orIfFAdhyh1G8WzS2MScFYNbgZMwFjJK8/gxM3FddZqC9GA+X9x6YsDWl2LBm2bqE1efT/PIP8f7tuTWD0UCwmyja8N/dQJJCoV+wgD7W2AXrFjkZJ7b1m319pLIRv92igYar17/4A6vPRyXnoH3A4cTSdPyqbAAAAAElFTkSuQmCC" />
            </a>
        </div>
        <ul class="list-group mt-5 mb-5">
        <% if(mails.length!=0) {%>
            <% mails.forEach(mail=>{ %>
                <% for(i=0;i<mail.to.length;i++) {%>
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-md-2  first">
                                <img
                                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABMUlEQVRIS8WU0XHCMBBE90QBoQRUQRRTAR2QDpIKUkJMBRkqoAQoIQVgjzpQSnAKQMoo2Jmxse48YAf9ytq3OnmXMPGiifUxCOCMMVDqHYCpDVl4v9HWWsmgCHDL5Roh7HuFiJ51URw4CAtwxsyhlAMwT4hU8F5ra6sUhAdw7htFpVb6ePy8DpBlOYA4e25tdFnG7/qnyJ1k5z/KDc5v8AXgIWHkG94vrn6DKDrpX9S4/s3BbJYjhHMOiCxOp3yUHEhBkvbFoEkC0n4SUIfsDUQxyU1FtPXiqEI4wPtt6qF7AS7LXgB8MAnuGq9A9NpXGxeAWnwnXX1oN7UAA7pH4l50UxswrBokSKs6uoDY74+SArtPZHVRPDXfdAHhJvH6sC7LP93/BYzhvqtxvySPdZsfYf51GfqNCHwAAAAASUVORK5CYII=" />
                                <h5>
                                    <%= mail.to[i] %>
                                </h5>
                            </div>
                            <div class="col-md-8  second">
                                <%= mail.content %>
                            </div>
                            <div class="col-md-2 third">
                                <a href="/delete/<%= mail._id %>/<%= mail.to[i] %>/">Delete</a>
                                <a href="/show/<%= mail._id %>/">
                                    <img
                                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAABR0lEQVRYR+3Vyw3CMAwGYBum4EaYgJaBgCszUAkEK3AGNmCRpl0AyiZBOVTiEWInaQoV9Fon/fLHchG+7MEv88BvgS5JstQ3MCqKLfcmoiWkMYi40RClVMZFRQHdY+pkuKjGQefJZNFTame6Ig6qcZCGhKAaA1Xj8VCU5bVOxoRCxO0wzzNbgzcCqtJ0BgB7AJgLKQ8mFAej1wWD7jC14wXVBxhQydSLg0AGjBHFnUFBCVkwQSivhBgYPQ2Poih0bzk9zqCYGOcri41xArWBYYOqJDkA4tTaDJ4987wn2UNtYsiE2sZYQZ/A2EFpqogBshZSrpyGDKP4bQ9VdtDD/4rxHXaJDygaxufKomIo0GN/IJYiz0/s7D0LyTnkua/3sj+Iiq47CRFziDoo+V5IaQzDZw6RH+MUdB/EOWWMmu40dYzTc/a8AQtwryW8ez2iAAAAAElFTkSuQmCC" />
                                </a>
                            </div>
                        </div>
                    </li>
                <% } %>
            <% }) %>
        <% }else {%>
            <h2>No scheduled Mails</h2>
        <% } %>
    </ul>
</div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="textbox">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">New Message</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                        <label for="email">To</label>
                        <div>
                            <input type="email" id="email" name="toemail" class="form-control ml-3" placeholder="email"
                                >
                        </div>
                        <button class="btn btn-danger" onclick="addto()">Add</button>
                        <br>
                        <label for="ccemail">CC</label>
                        <div>
                            <input type="email" id="ccemail" name="toemail" class="form-control ml-3" placeholder="email">
                        </div>
                        <button class="btn btn-danger" onclick="addcc()">Add</button>
                        <br>
                        <div>
                            <label class="mt-3">Subject</label>
                            <textarea rows="2" cols="45" name="subject" id="sub">
                            </textarea>
                        </div>
                        <div>
                            <label class=" mt-3">Content</label>
                            <textarea rows="8" cols="45" name="content" id="con">
                            </textarea>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" onclick="shedule1()" name="schedule" id="radio1"
                                value="Recurring schedule">
                            <label class="form-check-label" for="radio1">Recurring schedule</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" onclick="shedule2()" name="schedule" id="radio2"
                                value="Weekly schedule">
                            <label class="form-check-label" for="radio2">Weekly schedule</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" onclick="shedule3()" name="schedule" id="radio3"
                                value="Monthly schedule">
                            <label class="form-check-label" for="radio3">Monthly schedule</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" onclick="shedule4()" name="schedule" id="radio4"
                                value="Yearly schedule">
                            <label class="form-check-label" for="radio4">Yearly schedule</label>
                        </div>

                        <div>
                            <select id="first" class="shedule custom-select" name="rsec">
                                <option selected>Recurring schedule</option>
                                <% for(let i=1;i<=60;i++) { %>
                                    <option value="<%= i %>">
                                        <%= i %>
                                    </option>
                                <% } %>
                            </select>
                            <select id="second" class="shedule custom-select" name="dayofweek">
                                <option selected>Weekly schedule</option>
                                <option value="sunday">Sunday</option>
                                <option value="monday">Monday</option>
                                <option value="tuesday">Tuesday</option>
                                <option value="wednesday">Wednesday</option>
                                <option value="thursday">Thursday</option>
                                <option value="friday">Friday</option>
                                <option value="saturday">Saturday</option>
                            </select>
                            <div>
                                <select id="third" class="shedule custom-select" name="mon">
                                    <option selected>Monthy schedule</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>

                                <div>
                                    <select id="fourth2" class="shedule custom-select" name="hours">
                                        <option selected>Hours</option>
                                        <% for(let i=1;i<=24;i++) { %>
                                            <option value="<%= i %>">
                                                <%= i %>
                                            </option>
                                            <% } %>
                                    </select>
                                    <select id="fourth1" class="shedule custom-select" name="days">
                                        <option selected>day</option>
                                        <% for(let i=1;i<=31;i++) { %>
                                            <option value="<%= i %>">
                                                <%= i %>
                                            </option>
                                            <% } %>
                                    </select>
                                    <select id="fourth3" class="shedule custom-select" name="min">
                                        <option selected>Minutes</option>
                                        <% for(let i=1;i<=60;i++) { %>
                                            <option value="<%= i %>">
                                                <%= i %>
                                            </option>
                                            <% } %>
                                    </select>
                                </div>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn" data-dismiss="modal">Close</button>
                            <button type="button" class="btn bg-danger" onclick="submit1()">Submit</button>
                        </div>
                </div>
            </div>
        </div>
            <script>
                tousers = []
                ccusers = []
                localStorage['to_email'] = JSON.stringify(tousers)
                localStorage['cc_email'] = JSON.stringify(ccusers)
                function shedule1() {
                    const reccuring = document.getElementById("radio1");
                    if (reccuring.value == "Recurring schedule") {
                        document.getElementById("first").style.display = 'block'
                        document.getElementById("second").style.display = 'none'
                        document.getElementById("third").style.display = 'none'
                        document.getElementById("fourth1").style.display = 'none'
                        document.getElementById("fourth2").style.display = 'none'
                        document.getElementById("fourth3").style.display = 'none'

                    }
                }
                function shedule2() {
                    const weekly = document.getElementById("radio2");
                    if (weekly.value == "Weekly schedule") {
                        document.getElementById("first").style.display = 'none'
                        document.getElementById("second").style.display = 'block'
                        document.getElementById("third").style.display = 'none'
                        document.getElementById("fourth1").style.display = 'none'
                        document.getElementById("fourth2").style.display = 'none'
                        document.getElementById("fourth3").style.display = 'none'
                    }
                }
                function shedule3() {
                    const monthly = document.getElementById("radio3");
                    if (monthly.value == "Monthly schedule") {
                        document.getElementById("first").style.display = 'none'
                        document.getElementById("second").style.display = 'none'
                        document.getElementById("third").style.display = 'block'
                        document.getElementById("fourth1").style.display = 'none'
                        document.getElementById("fourth2").style.display = 'none'
                        document.getElementById("fourth3").style.display = 'none'
                    }
                }
                function shedule4() {
                    const yearly = document.getElementById("radio4");
                    if (yearly.value == "Yearly schedule") {
                        document.getElementById("first").style.display = 'none'
                        document.getElementById("second").style.display = 'none'
                        document.getElementById("third").style.display = 'block'
                        document.getElementById("fourth1").style.display = 'block'
                        document.getElementById("fourth2").style.display = 'block'
                        document.getElementById("fourth3").style.display = 'block'
                    }
                }
                function addto()
                {
                    var to_email = document.getElementById('email').value
                    let to_email_array = JSON.parse(localStorage['to_email'])
                    to_email_array.push(to_email)
                    localStorage['to_email'] = JSON.stringify(to_email_array)
                    document.getElementById('email').value = ""
                    console.log(localStorage['to_email'])
                }
                function addcc() 
                {
                    var cc_email = document.getElementById('ccemail').value
                    let cc_email_array = JSON.parse(localStorage['cc_email'])
                    cc_email_array.push(cc_email)
                    localStorage['cc_email'] = JSON.stringify(cc_email_array)
                    document.getElementById('ccemail').value = ""
                    console.log(localStorage['cc_email'])
                }
                async function submit1()
                {
                    var data = {
                        to: JSON.parse(localStorage['to_email']),
                        cc : JSON.parse(localStorage['cc_email']),
                        sub: document.getElementById('sub').value,
                        con: document.getElementById('con').value
                    }
                    var ele = document.getElementsByName('schedule');

                    for (i = 0; i < ele.length; i++) {
                        if (ele[i].checked)
                        {
                            data.type = ele[i].value;
                            break;
                        }
                    }
                    if(data.type == 'Recurring schedule')
                        data.sec = document.getElementById('first').value
                    else if(data.type == 'Monthly schedule')
                        data.mon = document.getElementById('third').value
                    else if(data.type == 'Weekly schedule')
                        data.dayofweek = document.getElementById('second').value
                    else if(data.type == 'Yearly schedule')
                    {
                        data.mon = document.getElementById('third').value
                        data.hours = document.getElementById('fourth2').value
                        data.min = document.getElementById('fourth3').value
                        data.day = document.getElementById('fourth1').value
                    }
                    const sts = await axios.post('/send-mail', data)
                    alert('success')
                    var url = window.location.href
                    var domain = url.replace('http://', '').replace('https://', '').split(/[/?#]/)[0];
                    location.replace(`http://${domain}/`)
                }
            </script>
<%- include('partials/footer') %>